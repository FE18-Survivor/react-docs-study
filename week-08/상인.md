# Lifecycle of Reactive Effects

## Effectì˜ ë¼ì´í”„ì‚¬ì´í´

- Effectì˜ ë¼ì´í”„ì‚¬ì´í´ì€ **ë™ê¸°í™” ì‹œì‘**ê³¼ **ë™ê¸°í™” ì •ì§€(cleanup)**
- ê°™ì€ ì»´í¬ë„ŒíŠ¸ê°€ ê³„ì† ë§ˆìš´íŠ¸ëœ ìƒíƒœì—ì„œë„, `props, state`ê°€ ë°”ë€Œë©´ ì‚¬ì´í´ì´ ì—¬ëŸ¬ ë²ˆ ë°˜ë³µë  ìˆ˜ ìˆë‹¤

## ì—¬ëŸ¬ ë²ˆ ë™ê¸°í™”ê°€ ì¼ì–´ë‚˜ëŠ” ì´ìœ 

- ì´ì „ ë Œë”ì—ì„œ ë§Œë“  cleanupì„ í˜¸ì¶œí•´ ì—°ê²° ëŠê¸°
- ìƒˆ ë Œë”ì˜ Effectë¥¼ ì‹¤í–‰í•´ ìƒˆ ë°©ì— ì—°ê²°

```jsx
function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
  return <h1>Welcome to the {roomId} room!</h1>;
}
```

UIê°€ ê°€ë¦¬í‚¤ëŠ” roomIdì™€ ì‹¤ì œ ì—°ê²°ëœ roomIdê°€ ì¼ì¹˜í•´ì•¼ í•œë‹¤. Effectì˜ ë™ê¸°í™”ëŠ” ì´ë“¤ì„ ì¼ì¹˜ì‹œí‚¤ê¸° ìœ„í•œ ì¥ì¹˜ë¼ê³  ìƒê°í•˜ê¸°

## ReactëŠ” Effectë¥¼ ì–´ë–»ê²Œ ë™ê¸°í™” í•˜ëŠ”ì§€

- roomId propì´ ë°”ë€” ë•Œë§ˆë‹¤ **ì´ì „ ì—°ê²°ì„ ì¤‘ì§€í•˜ê³  ìƒˆ ì—°ê²°ì„ ì‹œì‘í•˜ëŠ” ê²ƒ** ì„ ìë™ìœ¼ë¡œ ë°˜ë³µí•œë‹¤. (Effect ì¬ë™ê¸°í™”)

```jsx
function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
  return <h1>Welcome to the {roomId} room!</h1>;
}
```

## ì»´í¬ë„ŒíŠ¸ ê´€ì  vs Effect ê´€ì 

roomIdê°€ `general -> travel -> music -> ë‹¤ë¥¸ í™”ë©´ ì´ë™` ìœ¼ë¡œ ë°”ë€” ë•Œ

ì»´í¬ë„ŒíŠ¸

- ChatRoom ë§ˆìš´íŠ¸ with "general"
- ChatRoom ì—…ë°ì´íŠ¸ with "travel"
- ChatRoom ì—…ë°ì´íŠ¸ with "music"
- ChatRoom ì–¸ë§ˆìš´íŠ¸

Effect

- Effect "general" ì—°ê²°
- Effect "general" ì—°ê²° ì¢…ë£Œ, Effect "travel" ì—°ê²°
- Effect "travel" ì—°ê²° ì¢…ë£Œ, "music" ì—°ê²°
- Effect "music" ì—°ê²° ì¢…ë£Œ

> ì»´í¬ë„ŒíŠ¸ì˜ ë¼ì´í”„ ì‚¬ì´í´ê³¼ëŠ” ìƒê´€ì—†ì´ Effectì˜ ì‚¬ì´í´ë§Œì„ ìƒê°í•´ë¼

## deps: Effectë¥¼ ë‹¤ì‹œ ë™ê¸°í™”ë¥¼ í•  ì§€ ì¸ì‹

- ì˜ì¡´ì„± ë°°ì—´ì˜ ê°’ë“¤ì„ ë¹„êµí•œ í›„ì— ê°’ì´ ë‹¤ë¥´ë©´ Effectë¥¼ ë‹¤ì‹œ ë™ê¸°í™”

```jsx
function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]); // depsì— ì¶”ê°€í•˜ì—¬ ì•Œë ¤ì£¼ê¸°
}
```

## EffectëŠ” í•˜ë‚˜ì˜ ë™ê¸°í™”

- Effectê°€ ë™ê¸°í™”ë  ë•Œ ì˜ë„í•˜ì§€ ì•Šì€ ë™ì‘ì„ í•˜ë©´ ì•ˆëœë‹¤.
- ë”°ë¡œ ì‘ì„± -> ì½”ë“œë¥¼ ê¹”ë”í•˜ê²Œ ìª¼ê°œëŠ” ê¸°ì¤€ì´ ì•„ë‹ˆë¼ ë™ê¸°í™” ëŒ€ìƒì´ ê°™ì€ì§€ ê¸°ì¤€

```jsx
function ChatRoom({ roomId }) {
  useEffect(() => {
    logVisit(roomId);
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
  // ...
}
```

```jsx
function ChatRoom({ roomId }) {
  // ë°©ë¬¸ ë¡œì§ê³¼ ì—°ê²° ë¡œì§ì„ ë”°ë¡œ ì‘ì„±
  useEffect(() => {
    logVisit(roomId);
  }, [roomId]);

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    // ...
  }, [roomId]);
  // ...
}
```

## ë°˜ì‘í˜• ê°’ê³¼ ë¹ˆ deps

- props, state ë“± ê°™ì€ ë³€í™”ë˜ëŠ” ê°’, ë Œë”ë§ì— ê³„ì‚°ë˜ëŠ” ê°’
- ë°˜ì‘í˜• ê°’ì€ ëª¨ë‘ depsì— í¬í•¨ë˜ì–´ì•¼ í•œë‹¤.
- set í•¨ìˆ˜ë‚˜ ref ê°ì²´ ê°™ì€ ê²½ìš°ì—ëŠ” ë°˜ì‘í•˜ì§€ ì•ŠëŠ” ê°’ë“¤ì´ë‹¤. ì´ë“¤ì€ depsì— í¬í•¨í•˜ì§€ ì•Šì•„ë„ ë¨
- ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ ìƒìˆ˜ ë˜ëŠ” Effect ë‚´ë¶€ì—ì„œë§Œ ì„ ì–¸ë˜ëŠ” ê°’ì€ ë Œë”ë§ì— ì˜í•´ ë°”ë€Œì§€ ì•Šìœ¼ë¯€ë¡œ ë°˜ì‘í˜•ì´ ì•„ë‹ˆê³  depsì— í¬í•¨í•  í•„ìš” X

```jsx
const serverUrl = "https://localhost:1234";

function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
  // ...
}
```

```jsx
const serverUrl = "https://localhost:1234";
const roomId = "general";

function ChatRoom() {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, []);
  // ...
}
```

```jsx
function ChatRoom() {
  useEffect(() => {
    const serverUrl = "https://localhost:1234";
    const roomId = "general";
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, []);
  // ...
}
```

# Separating Events from Effects

**ì´ ì½”ë“œê°€ ì–¸ì œ ì‹¤í–‰ë¼ì•¼ í•˜ëŠ”ê°€?**ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì“¸ì§€ Effectë¥¼ ì“¸ì§€ ê²°ì •

- ì´ë²¤íŠ¸: ìœ ì € actionì— ì˜í•´ ì¼ì–´ë‚¨
- Effect: ë™ê¸°í™”ë¥¼ í•´ì•¼í•  ë•Œ

```jsx
function ChatRoom({ roomId }) {
  const [message, setMessage] = useState("");
  // ...
  function handleSendClick() {
    sendMessage(message);
  }
  // ...
  return <>...</>;
}
```

```jsx
function ChatRoom({ roomId }) {
  // ...
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
  // ...
}
```

## ë°˜ì‘í˜• ë¡œì§, ë°˜ì‘í˜• ê°’

- props, state, ì»´í¬ë„ŒíŠ¸ ë³¸ë¬¸ì—ì„œ ì„ ì–¸ëœ ë³€ìˆ˜ëŠ” ëª¨ë‘ reactive value
- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë¡œì§ì€ reactiveë©´ ì•ˆë¨ -> reactive valueê°€ ë°”ë€Œì–´ë„ ì¬ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤â€‹
- Effect ë¡œì§ì€ reactive, ë‚´ë¶€ì—ì„œ ì½ì€ reactive valueë¥¼ depsì— ë„£ìœ¼ë©´ ê·¸ ê°’ì´ ë°”ë€” ë•Œë§ˆë‹¤ ë‹¤ì‹œ ì‹¤í–‰ëœë‹¤.
  â€‹

## EffectEvent

### ë¬¸ì œ ìƒí™©

ì•„ë˜ëŠ” **ì—°ê²°ëì„ ë•Œ ì•Œë¦¼** ë¡œì§ì´ **í…Œë§ˆê°€ ë°”ë€” ë•Œë§ˆë‹¤ ì¬ì—°ê²° + ì•Œë¦¼** ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ì½”ë“œ

```jsx
function ChatRoom({ roomId, theme }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on("connected", () => {
      showNotification("Connected!", theme);
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, theme]);

  return <h1>Welcome to the {roomId} room!</h1>;
}
```

### useEffectEvent ì‚¬ìš©í•˜ê¸°

useEffectEventë¡œ ì•Œë¦¼ ë¡œì§ì„ ë¶„ë¦¬

- Effect Event ì•ˆ ë¡œì§ì€ nonâ€‘reactiveì´ì§€ë§Œ, í•­ìƒ ìµœì‹  props/stateë¥¼ ì½ì„ ìˆ˜ ìˆë‹¤

```jsx
function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(() => {
    showNotification("Connected!", theme);
  });

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on("connected", () => {
      onConnected();
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);
}
// ...
```

### Effect Eventì™€ Linter

- numberOfItemsì— ë°˜ì‘í•˜ì§€ ì•Šê³  ì‹¶ì€ë° ë¦°í„°ê°€ ê²½ê³ í•¨
- Effect Eventë¡œ ë§Œë“¤ê³ , Effect ë‚´ë¶€ëŠ” ë°˜ì‘í˜•ë¡œì§ìœ¼ë¡œ ë‘˜ì„ ë¶„ë¦¬

```jsx
function Page({ url }) {
  const { items } = useContext(ShoppingCartContext);
  const numberOfItems = items.length;

  useEffect(() => {
    logVisit(url, numberOfItems);
  }, [url]); // ğŸ”´ React Hook useEffect has a missing dependency: 'numberOfItems'
  // ...
}
```

```jsx
function Page({ url }) {
  const { items } = useContext(ShoppingCartContext);
  const numberOfItems = items.length;

  const onVisit = useEffectEvent((visitedUrl) => {
    logVisit(visitedUrl, numberOfItems);
  });

  useEffect(() => {
    onVisit(url);
  }, [url]);
  // ...
}
```

### Effect Eventì— ì¸ìë¥¼ ë„˜ê¸°ëŠ” ì´ìœ 

- **urlì´ ë°”ë€Œë©´ ë‹¤ë¥¸ visit ì´ë²¤íŠ¸**ë¼ëŠ” ì˜ë¯¸ê°€ ë” ëª…í™•, depsì—ì„œ urlì„ ë¹¼ ë¨¹ì—ˆì„ ë•Œ ë¦°í„°ê°€ ì•Œë ¤ì¤Œ
- ë¹„ë™ê¸° ìƒí™© ì—ì„œë„ **visitedUrl** ê³¼ **í˜„ì¬ url**ë¡œ ì˜ë¯¸ê°€ í™•ì‹¤í•˜ê²Œ ë¶„ë¦¬ëœë‹¤.

```jsx
const onVisit = useEffectEvent((visitedUrl) => {
  logVisit(visitedUrl, numberOfItems);
});

useEffect(() => {
  setTimeout(() => {
    onVisit(url);
  }, 5000);
}, [url]);
```

### Effect Eventë¥¼ ì™¸ë¶€ë¡œ ì „ë‹¬í•˜ì§€ ë§ê¸°

- Effect ë‚´ë¶€ì—ì„œë§Œ í˜¸ì¶œ
- ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸, í›…ìœ¼ë¡œ propsë‚˜ ì¸ìë¡œ ì „ë‹¬ X (depsë¥¼ ê³„ì†í•´ì„œ ì¶”ì í•´ì„œ ì§€ì •í•´ì•¼í•¨)
